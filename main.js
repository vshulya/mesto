(()=>{"use strict";class e{constructor(e){var t,s;s=e=>{"Escape"===e.key&&this.close()},(t="_handleEscClose")in this?Object.defineProperty(this,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):this[t]=s,this._element=e}open(){this._element.classList.add("pop-up_opened"),document.addEventListener("keydown",this._handleEscClose)}close(){this._element.classList.remove("pop-up_opened"),document.removeEventListener("keydown",this._handleEscClose)}setEventListeners(){this._element.querySelector(".pop-up__close").addEventListener("click",(()=>{this.close()})),this._element.addEventListener("mousedown",(e=>{e.target.classList.contains("pop-up_opened")&&this.close()}))}}class t extends e{constructor(e,t){super(e),this._handleFormSubmit=t,this._form=this._element.querySelector(".pop-up__form"),this._inputList=this._element.querySelectorAll(".pop-up__input"),this._submitButton=this._element.querySelector(".pop-up__button"),this._buttonTextBackup=this._submitButton.textContent}_getInputValues(){return this._formValues={},this._inputList.forEach((e=>{this._formValues[e.name]=e.value})),this._formValues}changeSubmitHandler(e){this._handleFormSubmit=e}_isLoading(){this._submitButton.textContent="Сохранение..."}_hideLoading(){this._submitButton.textContent=this._buttonTextBackup}setEventListeners(){this._element.addEventListener("submit",(e=>{e.preventDefault(),this._isLoading(),this._handleFormSubmit(this._getInputValues())})),super.setEventListeners()}close(){super.close(),this._form.reset(),this._hideLoading()}}class s{constructor(e,t,s,r,i){this._link=e.link,this._name=e.name,this._likes=e.likes,this._id=e.id,this._userId=e.userId,this._ownerId=e.ownerId,this._cardSelector=t,this._handleCardClick=s,this._handleCardDelete=r,this._handleLikeClick=i}_getTemplate(){return document.querySelector(this._cardSelector).content.querySelector(".card").cloneNode(!0)}generateCard(){return this._element=this._getTemplate(),this._cardImage=this._element.querySelector(".card__image"),this._cardLike=this._element.querySelector(".card__like"),this._likeCountElement=this._element.querySelector(".card__likes-number"),this._cardImage.src=this._link,this._cardImage.alt=this._name,this._element.querySelector(".card__text").textContent=this._name,this.setLikes(this._likes),this._ownerId!==this._userId&&(this._element.querySelector(".card__delete-button").style.display="none"),this._setEventListeners(),this._element}isLiked(){return this._likes.find((e=>e._id===this._userId))}setLikes(e){this._likes=e,this._likeCountElement.textContent=this._likes.length,this._handleLikeIcon()}_handleLikeIcon(){this.isLiked()?this._cardLike.classList.add("card__like_active"):this._cardLike.classList.remove("card__like_active")}deleteCard(){this._element.remove(),this._element=null}_setEventListeners(){this._cardImage.addEventListener("click",(()=>{this._handleCardClick(this._name,this._link)})),this._element.querySelector(".card__delete-button").addEventListener("click",(()=>{this._handleCardDelete(this._id)})),this._cardLike.addEventListener("click",(()=>{this._handleLikeClick(this._id)}))}}function r(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}class i{constructor(e,t){r(this,"_showInputError",((e,t)=>{var s=this._formElement.querySelector("#".concat(e.id,"-error"));s.classList.add(this._errorClass),s.textContent=t,e.classList.add(this._inputErrorClass)})),r(this,"_hideInputError",(e=>{var t=this._formElement.querySelector("#".concat(e.id,"-error"));t.textContent="",t.classList.remove(this._errorClass),e.classList.remove(this._inputErrorClass)})),r(this,"resetInputs",(()=>{this._inputList.forEach((e=>{this._hideInputError(e)}))})),r(this,"_checkInputValidity",(e=>{e.validity.valid?this._hideInputError(e):this._showInputError(e,e.validationMessage)})),r(this,"_hasInvalidInput",(()=>Array.from(this._inputList).some((e=>!e.validity.valid)))),r(this,"_toggleButtonState",(()=>{this._hasInvalidInput()?(this._submitButton.classList.add(this._inactiveButtonClass),this._submitButton.disabled=!0):(this._submitButton.classList.remove(this._inactiveButtonClass),this._submitButton.disabled=!1)})),r(this,"_setListeners",(()=>{this._toggleButtonState(),this._inputList.forEach((e=>{e.addEventListener("input",(()=>{this._checkInputValidity(e),this._toggleButtonState()}))}))})),r(this,"enableValidation",(()=>{this._formElement.addEventListener("submit",(function(e){e.preventDefault()})),this._setListeners()})),this._inputSelector=e.inputSelector,this._submitButtonSelector=e.submitButtonSelector,this._inactiveButtonClass=e.inactiveButtonClass,this._inputErrorClass=e.inputErrorClass,this._errorClass=e.errorClass,this._formElement=t,this._submitButton=this._formElement.querySelector(this._submitButtonSelector),this._inputList=this._formElement.querySelectorAll(this._inputSelector)}resetValidation(){this._toggleButtonState(),this._inputList.forEach((e=>{this._hideInputError(e)}))}}var n,o=new class{constructor(e){var t=e.baseUrl,s=e.headers;this._headers=s,this._baseUrl=t}_checkResponse(e){return e.ok?e.json():Promise.reject("Ошибка ".concat(e.status))}getProfile(){return fetch("".concat(this._baseUrl,"/users/me"),{headers:this._headers}).then(this._checkResponse)}getInitialCards(){return fetch("".concat(this._baseUrl,"/cards"),{headers:this._headers}).then(this._checkResponse)}editProfile(e,t){return fetch("".concat(this._baseUrl,"/users/me"),{method:"PATCH",headers:this._headers,body:JSON.stringify({name:e,about:t})}).then(this._checkResponse)}addCard(e,t){return fetch("".concat(this._baseUrl,"/cards"),{method:"POST",headers:this._headers,body:JSON.stringify({name:e,link:t})}).then(this._checkResponse)}deleteCard(e){return fetch("".concat(this._baseUrl,"/cards/").concat(e),{method:"DELETE",headers:this._headers}).then(this._checkResponse)}deleteLike(e){return fetch("".concat(this._baseUrl,"/cards/").concat(e,"/likes "),{method:"DELETE",headers:this._headers}).then(this._checkResponse)}addLike(e){return fetch("".concat(this._baseUrl,"/cards/").concat(e,"/likes "),{method:"PUT",headers:this._headers}).then(this._checkResponse)}editAvatar(e){return fetch("".concat(this._baseUrl,"/users/me/avatar "),{method:"PATCH",headers:this._headers,body:JSON.stringify({avatar:e})}).then(this._checkResponse)}}({baseUrl:"https://mesto.nomoreparties.co/v1/cohort-37",headers:{authorization:"25c2c7dc-18ba-4ba3-98ff-8581a7c55886","Content-Type":"application/json"}}),a={formSelector:".pop-up__form",inputSelector:".pop-up__input",submitButtonSelector:".pop-up__button",inactiveButtonClass:"pop-up__button_disabled",inputErrorClass:"pop-up__input_type_error",errorClass:"pop-up__input-error_visible"},l=(document.querySelector(".cards-list"),document.querySelector(".pop-up_place_title")),c=document.querySelector(".pop-up_place_card"),h=document.querySelector(".pop-up_place_fullsize-photo"),u=document.querySelector(".pop-up_place_card-delete"),_=document.querySelector(".pop-up_place_profile-photo"),d=document.querySelector(".profile__edit-button"),p=(l.querySelector(".pop-up__close"),document.querySelector(".profile__add-button")),m=(c.querySelector(".pop-up__close"),h.querySelector(".pop-up__close"),document.querySelector(".card__delete-button"),document.querySelector(".profile__image-button")),f=(document.querySelector(".pop-up__input_type_name"),document.querySelector(".pop-up__input_type_job"),document.querySelector(".pop-up__input_type_place"),document.querySelector(".pop-up__input_type_link"),document.querySelector(".profile__name")),v=document.querySelector(".profile__text"),y=document.querySelector(".profile__image");function b(e,t){(null==t||t>e.length)&&(t=e.length);for(var s=0,r=new Array(t);s<t;s++)r[s]=e[s];return r}document.querySelector(".pop-up__fullsize-photo"),document.querySelector(".pop-up__figcaption"),l.querySelector(".pop-up__form"),c.querySelector(".pop-up__form"),_.querySelector(".pop-up__form");var k=new class{constructor(e,t,s,r){this._userNameElement=e,this._userInfoElement=t,this._userPhotoElement=s,this._userIdElement=r}getUserInfo(){var e={};return e.name=this._userNameElement.textContent,e.about=this._userInfoElement.textContent,e.avatar=this._userPhotoElement.src,e._id=this._userIdElement,e}setUserInfo(e){this._userNameElement.textContent=e.name,this._userInfoElement.textContent=e.about,this._userPhotoElement.src=e.avatar,this._userIdElement=e._id}}(f,v,y),S=new i(a,l),E=new i(a,c),L=new i(a,_);S.enableValidation(),E.enableValidation(),L.enableValidation();var g=new t(l,(e=>{var t=e.name,s=e.about;o.editProfile(t,s).then((e=>{k.setUserInfo(e),g.close()})).catch((e=>{console.log(e)}))}),k.getUserInfo.bind(k));g.setEventListeners();var I=new t(c,(e=>{o.addCard(e.name,e.link,e.likes).then((e=>{B(e),I.close()})).catch((e=>{console.log(e)}))}));I.setEventListeners();var C=new t(u);C.setEventListeners();var q=new t(_,(e=>{o.editAvatar(e.avatar).then((e=>{k.setUserInfo(e),q.close()})).catch((e=>{console.log(e)}))}));function w(e){var t=new s(e,".card-template",(()=>{U.open(e.name,e.link)}),(e=>{console.log(e),C.open(),C.changeSubmitHandler((()=>{console.log("click"),o.deleteCard(e).then((e=>{t.deleteCard(e),C.close()})).catch((e=>{console.log(e)}))}))}),(e=>{t.isLiked()?o.deleteLike(e).then((e=>{t.setLikes(e.likes)})).catch((e=>{console.log(e)})):o.addLike(e).then((e=>{t.setLikes(e.likes)})).catch((e=>{console.log(e)}))}));return t.generateCard()}function B(e){var t=w({name:e.name,link:e.link,likes:e.likes,id:e._id,userId:n,ownerId:e.owner._id});x.addItem(t)}q.setEventListeners();var x=new class{constructor(e,t){var s=e.data,r=e.renderer;this._renderedItems=s,this._renderer=r,this._container=document.querySelector(t)}renderItems(e){this._renderedItems=e,this._renderedItems.forEach((e=>this._renderer(e)))}addItem(e){this._container.prepend(e)}}({data:[],renderer:function(e){var t=w(e);x.addItem(t)}},".cards-list");Promise.all([o.getProfile(),o.getInitialCards()]).then((e=>{var t,s,r=(s=2,function(e){if(Array.isArray(e))return e}(t=e)||function(e,t){var s=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=s){var r,i,n=[],o=!0,a=!1;try{for(s=s.call(e);!(o=(r=s.next()).done)&&(n.push(r.value),!t||n.length!==t);o=!0);}catch(e){a=!0,i=e}finally{try{o||null==s.return||s.return()}finally{if(a)throw i}}return n}}(t,s)||function(e,t){if(e){if("string"==typeof e)return b(e,t);var s=Object.prototype.toString.call(e).slice(8,-1);return"Object"===s&&e.constructor&&(s=e.constructor.name),"Map"===s||"Set"===s?Array.from(e):"Arguments"===s||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s)?b(e,t):void 0}}(t,s)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),i=r[0],o=r[1];k.setUserInfo(i),n=i._id,o.forEach((e=>{B(e),x.renderItems(e)}))})).catch((e=>{console.log(e)}));var U=new class extends e{constructor(e){super(e),this._img=e.querySelector(".pop-up__fullsize-photo"),this._caption=e.querySelector(".pop-up__figcaption")}open(e,t){this._caption.textContent=e,this._img.src=t,this._img.alt=e,super.open()}}(h);U.setEventListeners(),d.addEventListener("click",(()=>{g.open(),S&&S.resetValidation()})),p.addEventListener("click",(()=>{I.open(),E&&E.resetValidation()})),m.addEventListener("click",(()=>{q.open(),L&&L.resetValidation()}))})();